Resources:
  # You still need the ability to carry out the resource actions in the template.
  CloudFormationFullAccess:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: CloudFormationFullAccess
      PolicyDocument: {
        "Version":"2012-10-17",
        "Statement":[
          {
            "Effect":"Allow",
            "Action": "cloudformation:*",
            "Resource":"*"
          }
        ]
      }

  ### DEV
  OrganizationAccountAccessServerlessOpsDevPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-dev
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_dev}:role/OrganizationAccountAccessRole"
          }
        ]
      }

  OrganizationAccountAccessServerlessOpsDevUsersPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-dev-Users
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_dev}:role/OrganizationAccountAccessUserRole"
          }
        ]
      }

  OrganizationAccountAccessServerlessOpsDevAdminsPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-dev-Admins
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_dev}:role/OrganizationAccountAccessAdminRole"
          }
        ]
      }

  ### PROD
  OrganizationAccountAccessServerlessOpsProdPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-prod
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_prod}:role/OrganizationAccountAccessRole"
          }
        ]
      }

  OrganizationAccountAccessServerlessOpsProdUsersPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-prod-Users
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_prod}:role/OrganizationAccountAccessUserRole"
          }
        ]
      }

  OrganizationAccountAccessServerlessOpsProdAdminsPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-training-prod-Admins
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.training_account_number_prod}:role/OrganizationAccountAccessAdminRole"
          }
        ]
      }


Outputs:
  CloudFormationFullAccessArn:
    Description: Policy ARN
    Value:
      Ref: CloudFormationFullAccess
    Export:
      Name: ${self:service}-${self:provider.stage}-CloudFormationFullAccessArn

  ### DEV
  OrganizationAccountAccessServerlessOpsDevPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsDevPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevPolicyArn

  OrganizationAccountAccessServerlessOpsDevUsersPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsDevUsersPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevUsersPolicyArn

  OrganizationAccountAccessServerlessOpsDevAdminPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsDevAdminsPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevAdminPolicyArn

  ### PROD
  OrganizationAccountAccessServerlessOpsProdPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsProdPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsProdPolicyArn

  OrganizationAccountAccessServerlessOpsProdUsersPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsProdUsersPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsProdUsersPolicyArn

  OrganizationAccountAccessServerlessOpsProdAdminPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsProdAdminsPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsProdAdminPolicyArn
